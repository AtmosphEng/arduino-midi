/**
 * @file MidiFromUDP
 * @author Phil Schatzmann
 * @brief Example of handling midi input over udp - sound beneration requires arduino-stk
 * 
 * @copyright Copyright (c) 2021
 * 
 */
#include <WiFi.h>
#include <WiFiClient.h>
#include <WiFiUdp.h>
#include <Midi.h>
#include <StkAll.h>

ArdI2SOut i2s;
WiFiUDP udp;
Clarinet clarinet(440);
ArdMidiEventHandler handler(&clarinet);
ArdMidiStreamIn in(udp, handler );
int localPort = 9000;

void setup() {
  Serial.begin(115200);
  
  // startup wifi - udp
  WiFi.begin(SSID, PWD);
  while (WiFi.status() != WL_CONNECTED) {
    Serial.print('.');
    delay(1000);
  }

  Serial.print("Connected to IP address: ");
  Serial.println(WiFi.localIP());  
  udp.begin(localPort);

  // setup i2s
  i2s_pin_config_t my_pin_config = {
      .bck_io_num = 26,
      .ws_io_num = 25,
      .data_out_num = 22,
      .data_in_num = I2S_PIN_NO_CHANGE
  };

  i2s.setPins(my_pin_config);
  i2s.begin();
}

void loop() {
  in.loop();
  i2s.tick( handler.tick() );
}

